###############################################################################
# TARGETS
###############################################################################
# make install:
#	does a full make and installs the lde binary and man page
###############################################################################
srcdir = @srcdir@
VPATH = @srcdir@

LDE_VERSION=@LDEVERSION@

.EXPORT_ALL_VARIABLES:

###############################################################################
# Variables for binary installation
###############################################################################
# sbindir       = where to install binary (/sbin)
# mandir        = where to install man page (/usr/local/man/man1)
# program_name  = name of installed binary (lde)
###############################################################################
prefix = @prefix@
exec_prefix = @exec_prefix@
libdir = @libdir@
sbindir = @SBIN_LOCATION@
mandir = $(prefix)/man/man8
manext = 8
program_name = lde

###############################################################################
# Curses support (include only when defined as LDE_CURSES_SRC)
###############################################################################
@CURSES_PREFIX@CURSES_SRC=nc_lde.c nc_block.c nc_inode.c nc_dir.c
@CURSES_PREFIX@CURSES_OBJ=nc_lde.o nc_block.o nc_inode.o nc_dir.o

###############################################################################
# Other defines which might be useful
#
# -DREAD_PART_TABLES -- for ext2fs currently, can read in the full
#                       disk tables if undefined, or just one group at
#                       a time when defined (memory savings should really be on the
#                       order of kb, maybe 10's of kb)
# -DNO_WRITE_INODE   -- turn off inode writes
# -DPARANOID         -- open device read only at all times
# -DNO_KERNEL_BITOPS -- use the C bitop replacement code instead of the ones
#			in <asm/bitops.h>
# -DALPHA_CODE       -- Activate some of the code that is still Alpha
# -DBETA_CODE        -- Activate some of the code that is still Beta
# -DERRORS_SAVED=30  -- define the number of errors which are saved in the
#			error history log (default to 30 if not set below).
# -DHAVE_LIBGPM      -- use GPM Mouse support
#
###############################################################################
QUIET_CFLAGS=@shutup@
CPPFLAGS=@CPPFLAGS@ @DEFS@ @CURSES_INCLUDEDIR@
CFLAGS=-DLDE_VERSION=\"$(LDE_VERSION)\" $(CPPFLAGS) @CFLAGS@
LDFLAGS=@LDFLAGS@
LIBS=@LIBS@ @CURSES_LIBS@

###############################################################################
# Define compilers
###############################################################################
CC=@CC@
@SET_MAKE@
YACC=@YACC@
AR=@AR@
RM=@RM@ -f
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@ -m 0500
INSTALL_DATA = @INSTALL_DATA@

###############################################################################
#                          STOP EDITING HERE
###############################################################################

$(program_name):	all

all:
	( cd src ; $(MAKE) -f Makefile all )

clean:
	( cd src ; $(MAKE) -f Makefile clean )

clear:
	( cd src ; $(MAKE) -f Makefile clear )
	$(RM) macros/config.*
	$(RM) lde

dep:	depend

depend:
	( cd src ; $(MAKE) -f Makefile depend )

install:	$(program_name)
	${INSTALL_PROGRAM} $(program_name) $(sbindir)/$(program_name)
	${INSTALL_DATA} doc/lde.man $(mandir)/$(program_name).$(manext)

###############################################################################
#                     YOU SHOULD NEVER EVER NEED THESE
###############################################################################

doc/lde.man.text:	doc/lde.man
	groff -Tascii -P-u -P-b -man doc/lde.man > doc/lde.man.text

dist:	clear doc/lde.man.text all clean

tar:
	@if [ -f lde*tar.gz ] ; then mv -f lde*tar.gz old ; fi
	( cd ..; tar -cvz -f lde/lde-$(VERSION).tar.gz lde \
	   --exclude lde-$(VERSION).tar.gz --exclude RCS \
	   --exclude lde/test\* --exclude \*~ \
           --exclude .depend --exclude old \
           --exclude lde-$(VERSION).zip --exclude lde/Makefile \
           --exclude lde/macros/config.\* )

diff:
	( cd ..; diff -u --recursive --new-file \
	  -x 'lde-$(VERSION).zip' -x 'lde/Makefile' \
	  -x lde/old/untar/lde/Makefile  \
	  -x 'lde-$(VERSION).tar.gz' -x 'RCS' \
	  -x 'test*' -x '*~' \
	  -x '.depend' -x 'old' \
	  -x 'config.*' lde/old/untar/lde lde )
	  echo
	  echo

autoconf:
	cd macros
	autoconf ; $(RM) config.cache
